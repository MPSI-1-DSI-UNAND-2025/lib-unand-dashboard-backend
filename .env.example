# Server
PORT=3000
NODE_ENV=development

# MySQL (read-only user recommended)
MYSQL_HOST=127.0.0.1
MYSQL_PORT=3306
MYSQL_USER=readonly
MYSQL_PASSWORD=secret
MYSQL_DATABASE=library
MYSQL_POOL_LIMIT=10

# Redis
# Either provide REDIS_URL or host/port/password
# REDIS_URL=redis://:password@127.0.0.1:6379/0
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_PASSWORD=

# Dynamic fast loop (today count)
# Minimum gap between starts (ms) (actual cadence = max(interval, adaptive) + buffer + runTime)
VISITOR_SYNC_MIN_INTERVAL_MS=1000
# Extra buffer wait after each run (ms)
VISITOR_SYNC_BUFFER_MS=200

# Adaptive mode (optional). When enabled the loop can lower its effective interval based on average run duration.
# Enable adaptive logic: true / false
VISITOR_FAST_ADAPTIVE=false
# Average run duration * multiplier = target dynamic interval (before floors & min cap)
VISITOR_FAST_TARGET_MULTIPLIER=20
# Soft floor (will not go below unless minInterval is higher)
VISITOR_FAST_SOFT_FLOOR_MS=400
# Hard floor (absolute minimum effective interval)
VISITOR_FAST_HARD_FLOOR_MS=150

# (If you want very aggressive loop, e.g. ~300ms cadence, consider: 
# VISITOR_SYNC_MIN_INTERVAL_MS=600
# VISITOR_SYNC_BUFFER_MS=120
# VISITOR_FAST_ADAPTIVE=true
# VISITOR_FAST_TARGET_MULTIPLIER=18
# VISITOR_FAST_SOFT_FLOOR_MS=250
# VISITOR_FAST_HARD_FLOOR_MS=120 )

# Slow cron (weekly + monthly + yearly aggregates) runs daily at 00:05
VISITOR_SLOW_CRON=0 5 0 * * *

# Today counting mode:
# direct       -> query DB every time (range predicate)
# incremental  -> Redis rolling counter + periodic reconcile
# delta        -> baseline (count + max id) then only count new rows (no write hook needed)
TODAY_COUNT_MODE=direct

# SSE enable flag (future use; currently SSE always on for /api/visitors/today/stream)
ENABLE_SSE_TODAY=true
